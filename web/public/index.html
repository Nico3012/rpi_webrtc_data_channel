<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <script type="importmap">
        {
            "imports": {
                "lit": "/lit@3.2.1/lit-core.min.js"
            }
        }
    </script>
    <script type="module" src="webrtc-component.js"></script>
    <script type="module" src="script.js"></script>
    <script type="module">
        // Modern service worker registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    console.log('Service Worker registered:', registration.scope);

                    // Handle updates with modern approach
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker?.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                console.log('New content available, refreshing...');
                                window.location.reload();
                            }
                        });
                    });
                } catch (error) {
                    console.error('Service Worker registration failed:', error);
                }
            });
        }
    </script>
    <title>Drone Controller</title>
</head>

<body>
    <div class="container">
        <webrtc-connection id="webrtcConnection" rpi-address="10.3.141.1" rpi-port="8080"></webrtc-connection>
        <input id="rangeInput" type="range" min="0" max="1" step="0.01" value="0.5">
        <div>
            Pitch:<div id="pitch">...</div>
        </div>
        <div>
            Roll:<div id="roll">...</div><br>
        </div>
    </div>
</body>

</html>